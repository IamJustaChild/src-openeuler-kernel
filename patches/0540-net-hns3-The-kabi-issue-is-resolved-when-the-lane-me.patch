From 720b28e6e7d432bce4682ecda35dc1e472ce3ede Mon Sep 17 00:00:00 2001
From: Algernon <lixiaodong67@huawei.com>
Date: Sat, 26 Aug 2023 10:10:33 +0800
Subject: [PATCH 222/268] net:hns3 The kabi issue is resolved when the lane
 members are added to the ethtool_link_ksettings structure

driver inclusion
category: bugfix
bugzilla: https://gitee.com/src-openeuler/kernel/issues/I8EN49

--------------------------------

Fix it because hnae3_ Ae_ Get in ops structure_ Ksettings_ An_
Result, cfg_ Mac_ Speed_ Dup_ Kabi problem caused by changes in
h member parameters.

Signed-off-by: Xiaodong Li <lixiaodong67@huawei.com>
---
 drivers/net/ethernet/hisilicon/hns3/hnae3.h | 8 +++++++-
 include/linux/ethtool.h                     | 2 ++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/hisilicon/hns3/hnae3.h b/drivers/net/ethernet/hisilicon/hns3/hnae3.h
index b353b0b1915b..4e48be0e157a 100644
--- a/drivers/net/ethernet/hisilicon/hns3/hnae3.h
+++ b/drivers/net/ethernet/hisilicon/hns3/hnae3.h
@@ -611,12 +611,18 @@ struct hnae3_ae_ops {
 	int (*client_start)(struct hnae3_handle *handle);
 	void (*client_stop)(struct hnae3_handle *handle);
 	int (*get_status)(struct hnae3_handle *handle);
+#ifndef __GENKSYMS__
 	void (*get_ksettings_an_result)(struct hnae3_handle *handle,
 					u8 *auto_neg, u32 *speed, u8 *duplex,
 					u32 *lane_num);
-
 	int (*cfg_mac_speed_dup_h)(struct hnae3_handle *handle, int speed,
 				   u8 duplex, u8 lane_num);
+#else
+	void (*get_ksettings_an_result)(struct hnae3_handle *handle,
+					u8 *auto_neg, u32 *speed, u8 *duplex);
+	int (*cfg_mac_speed_dup_h)(struct hnae3_handle *handle, int speed,
+				   u8 duplex);
+#endif
 
 	void (*get_media_type)(struct hnae3_handle *handle, u8 *media_type,
 			       u8 *module_type);
diff --git a/include/linux/ethtool.h b/include/linux/ethtool.h
index e5e62d64f457..c81535afcb07 100644
--- a/include/linux/ethtool.h
+++ b/include/linux/ethtool.h
@@ -150,7 +150,9 @@ struct ethtool_link_ksettings {
 		__ETHTOOL_DECLARE_LINK_MODE_MASK(advertising);
 		__ETHTOOL_DECLARE_LINK_MODE_MASK(lp_advertising);
 	} link_modes;
+#ifndef __GENKSYMS__
 	u32	lanes;
+#endif
 };
 
 /**
-- 
2.34.1

